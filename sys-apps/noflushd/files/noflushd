#!/bin/sh
#RCUPDATE:2 3 4:70:This line is required for script management

. /etc/rc.d/config/functions
. /etc/rc.d/config/basic

SERVICE="noflushd"
opts="start stop restart"

PIDFILE=/var/run/noflushd.pid
EXE=/usr/sbin/noflushd

start() {
    
    # defaults
    TIMEOUT=60
    DISKS='/dev/discs/disc0/disc'
    EXTRA=''
    
    # Pull in configuration file if exists, overrides defaults
    [ -f /etc/noflushd.conf ] && . /etc/noflushd.conf
    
    OPTIONS='-n $TIMEOUT $DISKS $EXTRA'
    
    ebegin "Starting $SERVICE"
    start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $EXE -- $OPTIONS
    eend $? "Started $SERVICE." "Error starting $SERVICE."

}

stop() {
	ebegin "Stopping $SERVICE"
	start-stop-daemon --stop --quiet --pidfile $PIDFILE --exec $EXE
	eend $? "Stopped $SERVICE." "Error stopping $SERVICE."
}

restart() {
	stop
	sleep 1s
	start
}

doservice ${@}
