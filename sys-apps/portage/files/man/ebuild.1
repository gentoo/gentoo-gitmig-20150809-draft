.TH ebuild "1" "January 2001" "portage 1.4" 
.SH NAME
ebuild \- manual page for the ebuild program, the main user interface to the Portage system. 
.SH SYNOPSIS
.B ebuild
\fIfile\fR \fIcommand\fR [\fIcommand\fR]...
.SH DESCRIPTION
The ebuild program is the heart of the current implementation of the Portage system.  Accepting
an ebuild script and one or more commands as arguments, the ebuild program will parse the ebuild
script and execute the specified commands.  Commands exist to fetch sources, unpack sources,
compile sources, install object files into a temporary directory "image", merge the image to
the local filesystem, create a bzipped tarball package out of the image, and more.
.PP
.SH OPTIONS 
\fBFILE:\fR
.TP
This must be a valid ebuild script. For further information read ebuild(5).
.TP
\fBCOMMANDS:\fR
TP
\fBcheck\fR 
Checks to see if all build dependencies are satisfied.
.TP
\fBclean\fR
Cleans the temporary build directory that Portage has created for this particular
ebuild file.  The temporary build directory normally contains the extracted source
files as well as a possible "install image" (all the files that will be merged to
the local filesystem or stored in a package.  The location of the build directory
is set by the BUILD_PREFIX variable in \fI/etc/make.defaults\fR (it defaults to \fI/tmp/portage\fR.)  If you'd like to
override the BUILD_PREFIX, add the appropriate line to \fI/etc/make.conf\fR (where all
your particular customizations are supposed to go.)
.TP
Note: Currently, Portage doesn't clean up after a package has been created or merged.
This means that the BUILD_PREFIX directory will accumulate lots of things you probably
don't want  and should be manually cleaned regularly ("rm -rf /tmp/portage/*"  will  take
care of this.)  As Portage matures, a make.conf option will be added that will allow
you to control whether BUILD_PREFIX gets cleaned automatically or gets left as is.
.TP
\fBfetch\fR
Checks to see if all the sources specified in SRC_URI are available in DISTDIR (defined in \fI/etc/make.defaults\fR as
/usr/portage/distfiles) and have a valid
md5 checksum.  If the sources aren't available, an attempt is made to download them from the locations specified
in SRC_URI.  If multiple download locations are listed for a particular file, Portage pings each location to see
which location is closer.  The Gentoo Linux mirror at ftp://ftp.ibiblio.org is always considered as a possible
download location.  If for some reason the current or just-downloaded sources' md5 digests don't match those recorded
in files/digest-[package]-[version-rev], a warning is printed and ebuild exits with an error code of 1.
.TP
\fBunpack\fR
Extracts the sources to a subdirectory in the \fIbuild directory\fR (BUILD_PREFIX) 
by running the \fIsrc_unpack()\fR function in the ebuild file.  If no src_unpack()
function has been specified, a default src_unpack() function is used that extracts
all the files specified in SRC_URI.  The sources are normally extracted to ${BUILD_PREFIX}/[package]-[version-rev]/work.
This particular directory can be referenced by using the ${WORKDIR} variable.  If you're creating an ebuild,
you'll want to make sure that the S (source directory) variable defined at at the top of your ebuild script
points to the directory that contains your extracted sources.  Normally, this directory is ${WORKDIR}/${P}.
The src_unpack() function is also responsible for making the appropriate patches to the sources so that
they're ready for compilation.
.TP
\fBcompile\fR
Compiles the extracted sources by running the the \fIsrc_compile()\fR function specified in the ebuild
file.  When src_compile() starts, the current working directory will be set to ${S}.  When src_compile()
completes, the sources should be fully compiled.
.TP
\fBinstall\fR
Installs the package to the temporary \fIinstall directory\fR 
by running the \fIsrc_install()\fR function.  When completed, the \fIinstall directory\fR 
(${BUILD_PREFIX}/[package]-[version-rev]/image) will contain all the files that should either
be merged to the local file system or included in a binary package.
.TP
\fBqmerge\fR
This function installs all the files in the \fIinstall directory\fR
to the live filesystem. The process works as follows: first, the \fIpkg_preinst()\fR function (if specified)
is run.  Then, the files are merged into the live filesystem, and the installed files' md5 digests are 
recorded in \fI/var/db/pkg/[category]/[package]-[version-rev]/CONTENTS\fR. After all the files have been merged,
the \fIpkg_postinst()\fR function (if specified) is executed.
.TP
\fBmerge\fR
Normally, to merge an ebuild, you need to \fIfetch\fR, \fIunpack\fR, \fIcompile\fR, \fIinstall\fR and \fIqmerge\fR.
If you're simply interested in merging the ebuild, you can use this command, which will perform all these
steps for you, stopping along the way if a particular step doesn't complete successfully.  
.TP
\fBremerge\fR
Normally, you're not allowed to merge an ebuild when you have the exact same version (down to the revision) already
installed.  This command performs the same function as the \fImerge\fR command, with the exception that it allows
you to merge even if the exact same package is already on the system.
.TP
\fBunmerge\fR
This function first executes the \fIpkg_prerm\fR function (if specified.) Then it 
removes all files from the live filesystem that have a valid
md5 checksum and mtime in the package contents file.  Any empty directories are recursively
removed.
Finally, it runs \fIpkg_postrm\fR function (if specified.) It is safe to merge
a new version of a package first and then unmerge the old one; in fact, this is the recommended
package upgrade method.
.TP
\fBpackage\fR
This command is a lot like the \fImerge\fR command, except that after fetching, unpacking, compiling and installing,
a .tbz2 binary package tarball is created and stored in  ${PKGDIR}/All (${PKGDIR} defaults to /usr/portage/packages).
A symbolic link is created in ${PKGDIR}/[category] that points to the package in ${PKGDIR}/All.
.TP
\fBrpm\fR
Builds a RedHat RPM package from the files in the temporary \fIinstall
directory\fR.  At the moment, the ebuild's dependency information is not incorporated into the RPM.
.TP
.SH AUTHORS
Achim Gottinger <achim@gentoo.org>
Daniel Robbins <drobbins@gentoo.org>
.SH "SEE ALSO"
ebuild(5) make.defaults(5) make.conf(5)
.TP
The \fI/usr/bin/ebuild\fR script. 
The helper apps in \fI/usr/lib/portage/bin\fR.
.SH FILES
\fB/etc/make.conf\fR 
Contains variables for the build-process and 
overwrites those in make.defaults
.TP
\fB/etc/make.defaults\fR 
Contains the default variables for the build-process, 
you should edit \fI/etc/make.conf\fR instead.
.TP
