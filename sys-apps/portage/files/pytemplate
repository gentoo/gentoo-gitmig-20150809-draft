#! /usr/bin/env python
# Copyright 1999-2000 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License, v2 or later
# Author Daniel Robbins <drobbins@gentoo.org>
# $Header: /var/cvsroot/gentoo-x86/sys-apps/portage/files/pytemplate,v 1.2 2000/08/05 06:11:38 drobbins Exp $

import sys,string
from types import *

#global settings
gset={}

def setkey(mykey,myvalue):
	global gset
	mykey=string.split(mykey,".")
	keyptr=gset
	for x in mykey[:-1]:
		if not keyptr.has_key(x):
			keyptr[x]={}
		keyptr=keyptr[x]
	keyptr[mykey[-1]]=myvalue

def getkey(mykey):
	global gset
	mykey=string.split(mykey,".")
	keyptr=gset
	for x in mykey[:-1]:
		if type(keyptr) != DictionaryType:
			return
		if not keyptr.has_key(x):
			return
		keyptr=keyptr[x]
	if keyptr.has_key(mykey[-1]):
		return keyptr[mykey[-1]]
	return

def runfile(myarg):
	mylocals={}
	try:
		a=open(myarg,'r')
	except IOError:
		sys.stderr.write("Error opening "+myarg+".  Exiting.\n")
		return
	mylines=a.readlines()
	a.close()
	pos=0
	while pos<len(mylines):
		if mylines[pos][0:8]=="<!--code":
			mycode=""
			pos=pos+1
			while (pos<len(mylines)) and (mylines[pos][0:3]!="-->"):
				mycode=mycode+mylines[pos]
				pos=pos+1
			exec(mycode,globals(),mylocals)
		else:
			sys.stdout.write(mylines[pos])
		pos=pos+1

if len(sys.argv)>1:
	for x in sys.argv[1:]:
		runfile(x)
	sys.exit(0)
else:
	sys.stderr.write("pytemplate 1.0: Embedded Python Templater\n")
	sys.stderr.write("Copyright 1999-2000, Gentoo Technologies, Inc.\n")
	sys.stderr.write("Distributed under the GPL, v2 or later\n\n")
	sys.stderr.write("Usage: "+sys.argv[0]+" file0 [file1]...\n")
	sys.exit(1)

