#!/bin/bash
# $Header: /var/cvsroot/gentoo-x86/games-server/halflife-adminmod/files/modsetup,v 1.2 2004/07/18 03:18:58 dragonheart Exp $

source GENTOO_CFGDIR/modsetup.conf || { echo "Could not find config file!" ; exit 1 ; }

moddir=${PWD}
plugindir=${moddir}/../addons/adminmod/

gen_default_cfgs() {
	local m=${moddir}
	local c=${plugindir}/config/
	for f in adminmod.cfg plugin.ini ; do
		[ ! -e ${m}/${f} ] \
			&& cp ${c}/${f} ${m}/
	done
	c=${c}/Samples/
	for f in ips.ini maps.ini models.ini users.ini wordlist.txt ; do
		[ ! -e ${m}/${f} ] \
			&& cp ${c}/${f} ${m}/
	done
}

while :; do
case $1 in
	help)
		file=`dialog --title "Adminmod help" \
			--menu "Select Help File:" 16 80 10 \
			README.gz 'README' \
			CHANGES.gz 'ChangeLog' \
			admin_permission_levels.txt.gz 'Accessible Functions' \
			adminmod_accesslevel.txt.gz 'Access Level Explanation' \
			amx_error_codes.txt.gz 'AMX Errors' \
			html/toclist.htm 'HTML Docs' 2>&1`
		[ $? -eq 0 ] || exit 0
		file=${plugindir}/docs/${file}
		[ "${file:${#file}-3}" == "htm" ] \
			&& ${BROWSER} ${file} \
			|| less ${file}
		;;
	config)
		gen_default_cfgs
		file=`dialog --title "Adminmod config files" \
			--help-button \
			--menu "Select file to Edit:" 16 80 10 \
			adminmod.cfg 'Main adminmod configuration file' \
			plugin.ini 'Edit adminmod plugin list by hand' \
			users.ini 'List of admins and their access levels' \
			maps.ini 'List of maps admins can switch to' \
			ips.ini 'Set IPs for reserved slots' \
			models.ini 'Restrict model hacks' \
			wordlist.txt 'Filter bad words' 2>&1`
		if [ "${file:0:4}" == "HELP" ] ; then
			$0 help
		else
			[ -z "${file}" ] && exit 0
			${EDITOR} ${moddir}/${file}
		fi
		;;
	*)
		exit 0
		;;
esac
done
