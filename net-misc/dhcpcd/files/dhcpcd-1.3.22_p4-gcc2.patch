--- dhcpcd-1.3.22-pl4/dhcpconfig.c	2005-07-24 12:51:33 +0200
+++ dhcpcd-1.3.22-pl4.az/dhcpconfig.c	2005-07-24 12:53:34 +0200
@@ -382,8 +382,8 @@
       f=fopen(resolv_file, "w");
       if ( f )
 	{
-	  fprintf(f, "# Generated by dhcpcd for interface %s\n", IfName);
 	  int i;
+	  fprintf(f, "# Generated by dhcpcd for interface %s\n", IfName);
 	  if ( DhcpOptions.len[domainName] )
 	    fprintf(f,"domain %s\n",(char *)DhcpOptions.val[domainName]);
 	  
@@ -413,9 +413,9 @@
       f=fopen(nis_file, "w");
       if ( f )
 	{
-	  fprintf(f, "# Generated by dhcpcd for interface %s\n", IfName);
 	  int i;
 	  char *prefix=NULL;
+	  fprintf(f, "# Generated by dhcpcd for interface %s\n", IfName);
 	  if ( DhcpOptions.len[nisDomainName] ) {
 	      if ( DhcpOptions.len[nisServers] ) {
 		prefix=(char *)malloc(DhcpOptions.len[nisDomainName] + 15);
@@ -447,8 +447,10 @@
       f=fopen(ntp_file, "w");
       if ( f )
  	{
-	  fprintf(f, "# Generated by dhcpcd for interface %s\n", IfName);
  	  int net, mask;
+	  int i;
+	  char addr[4*3+3*1+1];
+	  fprintf(f, "# Generated by dhcpcd for interface %s\n", IfName);
  	  memcpy(&mask,DhcpOptions.val[subnetMask],4);
  	  net = DhcpIface.ciaddr & mask;
 
@@ -456,17 +458,15 @@
  	  fprintf(f,"restrict default noquery notrust nomodify\n");
  	  fprintf(f,"restrict 127.0.0.1\n");
   
-	      int i;
-	      char addr[4*3+3*1+1];
-	      for (i=0;i<DhcpOptions.len[ntpServers];i+=4)
-		{
-		  snprintf(addr,sizeof(addr),"%u.%u.%u.%u",
-		  ((unsigned char *)DhcpOptions.val[ntpServers])[i],
-		  ((unsigned char *)DhcpOptions.val[ntpServers])[i+1],
-		  ((unsigned char *)DhcpOptions.val[ntpServers])[i+2],
-		  ((unsigned char *)DhcpOptions.val[ntpServers])[i+3]);
-		  fprintf(f,"restrict %s nomodify notrap noquery\nserver %s\n",addr,addr);
-		}
+	  for (i=0;i<DhcpOptions.len[ntpServers];i+=4)
+	  {
+	    snprintf(addr,sizeof(addr),"%u.%u.%u.%u",
+	    ((unsigned char *)DhcpOptions.val[ntpServers])[i],
+	    ((unsigned char *)DhcpOptions.val[ntpServers])[i+1],
+	    ((unsigned char *)DhcpOptions.val[ntpServers])[i+2],
+	    ((unsigned char *)DhcpOptions.val[ntpServers])[i+3]);
+	    fprintf(f,"restrict %s nomodify notrap noquery\nserver %s\n",addr,addr);
+	  }
  	  
 	  fprintf(f, "driftfile /var/lib/ntp/ntp.drift\n");
  	  fprintf(f, "logfile /var/log/ntp.log\n");
--- dhcpcd-1.3.22-pl4/dhcpcd.c	2005-07-24 12:53:57 +0200
+++ dhcpcd-1.3.22-pl4.az/dhcpcd.c	2005-07-24 12:55:42 +0200
@@ -146,6 +146,8 @@
     if ( argc[i][0]=='-' )
 prgs: switch ( argc[i][s] )
 	{
+	  char *tmp;
+	  long m;
 	  case 0:
 	    i++;
 	    s=1;
@@ -158,9 +160,8 @@
 	    if ( argc[i][s+1] ) goto usage;
 	    i++;
 	    if ( ! argc[i] ) goto usage;
-	    char *tmp;
 	    errno = 0;
-	    long m=strtol(argc[i], &tmp, 0);
+	    m=strtol(argc[i], &tmp, 0);
 	    if (argc[i][0] == '\0' || *tmp != '\0' ) goto usage;
 	    if ((errno == ERANGE &&
 			(m == LONG_MAX || m == LONG_MIN )) ||
