Index: src/signals.c
===================================================================
RCS file: /cvsroot/gaim/gaim/src/signals.c,v
retrieving revision 1.13
retrieving revision 1.14
diff -u -u -r1.13 -r1.14
--- src/signals.c	10 Jan 2004 04:04:56 -0000	1.13
+++ src/signals.c	13 Jan 2004 02:15:46 -0000	1.14
@@ -415,6 +415,7 @@
 	GaimSignalData *signal_data;
 	GaimSignalHandlerData *handler_data;
 	GList *l, *l_next;
+	va_list tmp;
 
 	g_return_if_fail(instance != NULL);
 	g_return_if_fail(signal   != NULL);
@@ -440,16 +441,22 @@
 
 		handler_data = (GaimSignalHandlerData *)l->data;
 
+		/* This is necessary because a va_list may only be
+		 * evaluated once */
+		G_VA_COPY(tmp, args);
+
 		if (handler_data->use_vargs)
 		{
-			((void (*)(va_list, void *))handler_data->cb)(args,
+			((void (*)(va_list, void *))handler_data->cb)(tmp,
 														  handler_data->data);
 		}
 		else
 		{
-			signal_data->marshal(handler_data->cb, args,
+			signal_data->marshal(handler_data->cb, tmp,
 								 handler_data->data, NULL);
 		}
+
+		va_end(tmp);
 	}
 }
 
@@ -478,6 +485,7 @@
 	GaimSignalHandlerData *handler_data;
 	void *ret_val = NULL;
 	GList *l, *l_next;
+    va_list tmp;
 
 	g_return_val_if_fail(instance != NULL, NULL);
 	g_return_val_if_fail(signal   != NULL, NULL);
@@ -503,16 +511,19 @@
 
 		handler_data = (GaimSignalHandlerData *)l->data;
 
+		G_VA_COPY(tmp,args);
+
 		if (handler_data->use_vargs)
 		{
 			ret_val = ((void *(*)(va_list, void *))handler_data->cb)(
-				args, handler_data->data);
+				tmp, handler_data->data);
 		}
 		else
 		{
-			signal_data->marshal(handler_data->cb, args,
+			signal_data->marshal(handler_data->cb, tmp,
 								 handler_data->data, &ret_val);
 		}
+		va_end(tmp);
 	}
 
 	return ret_val;
