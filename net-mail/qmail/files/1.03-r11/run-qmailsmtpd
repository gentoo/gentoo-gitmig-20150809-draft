#!/bin/sh

# This is to make life easier
SERVICE=smtp

# We run this afterwards to allow appending of values etc.
[ -s ${QMAIL_CONTROLDIR}/conf-common ] && source ${QMAIL_CONTROLDIR}/conf-common
[ -s ${QMAIL_CONTROLDIR}/conf-${SERVICE}d ] && source ${QMAIL_CONTROLDIR}/conf-${SERVICE}d

# Now run it all
exec /usr/bin/softlimit -m 8000000 \
    ${QMAIL_TCPSERVER_PRE} \
    /usr/bin/tcpserver -H -R -v -x /etc/tcp.${SERVICE}.cdb -c ${MAXCONN} \
    -u ${QMAILDUID} -g ${NOFILESGID} \
    ${TCPSERVER_HOST} ${TCPSERVER_PORT} \
    ${QMAIL_SMTP_PRE} /var/qmail/bin/qmail-${SERVICE}d ${QMAIL_SMTP_POST} \
    2>&1
